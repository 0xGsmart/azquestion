/*
Site Name: AZQuestion
Author: Sang Nguyen
Author URI: http://sangnguyen.info
CreationDate:2014-12-21
Version: 1.0
*/
var app=angular.module("AZQuestion",["ui.router","ngCookies","ngResource","ngSanitize","ngTagsInput","angular-flash.service","angular-flash.flash-alert-directive","ui.bootstrap","restangular","angularFileUpload","ngProgress","hc.marked","ngAnimate","appRoutes","appDirectives","appFilters","appServices","appModal","MainCtrl","TagCtrl","TagService","BadgeCtrl","BadgeService","QuestionCtrl","UserCtrl","UserService","QuestionCtrl","QuestionService","AnswerCtrl","AnswerService","SystemCtrl","SystemService"]);app.config(["markedProvider",function(a){a.setOptions({renderer:new marked.Renderer,gfm:!0,tables:!0,breaks:!0,pedantic:!1,sanitize:!0,smartLists:!0,smartypants:!1,highlight:function(a){return hljs.highlightAuto(a).value}})}]),app.config(["tagsInputConfigProvider",function(a){a.setActiveInterpolation("tagsInput",{placeholder:!0})}]),app.config(["$httpProvider",function(a){a.interceptors.push("TokenInterceptor")}]),app.config(["flashProvider",function(a){a.errorClassnames.push("alert-danger"),a.warnClassnames.push("alert-warning"),a.infoClassnames.push("alert-info"),a.successClassnames.push("alert-success")}]),app.run(["$log","$rootScope","$timeout","$window","$state","$location","ngProgress","AuthenticationService","flash",function(a,b,c,d,e,f,g,h,i){b.$on("$stateChangeStart",function(a,c,d,f,j){b.currentState=c.name,b.currentParam=d,b.oldState=f.name,b.oldParam=j,g.start(),g.color("#d33"),g.height("4px"),b.pageTitle=c.title?c.title+" | Mạng xã hội hỏi đáp Việt Nam":"Mạng xã hội hỏi đáp Việt Nam",c.access.requiredLogin&&!h.isLogged&&(i.error="Bạn cần đăng nhập để truy cập vào khu vực này!",e.transitionTo("login"),a.preventDefault())}),b.$on("$stateChangeSuccess",function(){g.complete(),c(function(){d.scrollTo(45,0)},500)}),b.$on("$stateChangeError",function(){g.complete()})}]),app.run(["$rootScope",function(a){a.facebookAppId="762868437069360"}]),angular.module("appRoutes",[]).config(["$stateProvider","$urlRouterProvider","$locationProvider",function(a,b,c){b.otherwise("/404.html"),b.when("/_=_","/"),a.state("home",{url:"/",templateUrl:"views/public/home.html",controller:"ListQuestionController",access:{requiredLogin:!1}}).state("about",{url:"/gioi-thieu.html",templateUrl:"views/public/about.html",controller:"SystemController",title:"Giới thiệu",access:{requiredLogin:!1}}).state("help",{url:"/huong-dan.html",templateUrl:"views/public/help.html",controller:"SystemController",title:"Hướng dẫn",access:{requiredLogin:!1}}).state("policy",{url:"/quy-dinh-va-noi-quy.html",templateUrl:"views/public/policy.html",controller:"SystemController",title:"Quy định & Nội quy",access:{requiredLogin:!1}}).state("question-detail",{url:"/cau-hoi/chi-tiet/:id/:slug",templateUrl:"views/public/question/detail.html",controller:"DetailQuestionController",title:"Chi tiết câu hỏi",access:{requiredLogin:!1}}).state("system-question",{url:"/system/questions",templateUrl:"views/private/question/manage.html",controller:"ListQuestionController",title:"Quản lý câu hỏi",access:{requiredLogin:!0}}).state("system-question-edit",{url:"/system/questions/edit/:id",templateUrl:"views/private/question/edit.html",controller:"QuestionController",title:"Quản lý câu hỏi",access:{requiredLogin:!0}}).state("system-answer",{url:"/system/answers",templateUrl:"views/private/answer/manage.html",controller:"AnswerController",title:"Quản lý câu trả lời",access:{requiredLogin:!0}}).state("system-answer-detail",{url:"/system/answers/detail/:id",templateUrl:"views/private/answer/detail.html",controller:"AnswerController",title:"Quản lý câu trả lời",access:{requiredLogin:!0}}).state("badges",{url:"/danh-hieu.html",templateUrl:"views/public/badges.html",controller:"BadgeController",title:"Hệ thống danh hiệu",access:{requiredLogin:!1}}).state("system-badge",{url:"/system/badges",templateUrl:"views/private/badge/manage.html",controller:"BadgeController",title:"Quản lý danh hiệu",access:{requiredLogin:!0}}).state("system-badge-add",{url:"/system/badges/add",templateUrl:"views/private/badge/add.html",controller:"BadgeController",title:"Quản lý danh hiệu - Thêm mới",access:{requiredLogin:!0}}).state("system-badge-edit",{url:"/system/badges/edit/:id",templateUrl:"views/private/badge/edit.html",controller:"BadgeController",title:"Quản lý danh hiệu - Sửa",access:{requiredLogin:!0}}).state("users",{url:"/thanh-vien.html",templateUrl:"views/public/user/list.html",controller:"ListUserController",title:"Danh sách thành viên đã đăng ký",access:{requiredLogin:!1}}).state("profile",{url:"/thong-tin-thanh-vien/:id/:slug",templateUrl:"views/public/user/profile.html",controller:"ProfileUserController",title:"Chi tiết tài khoản",access:{requiredLogin:!1}}).state("forgot_password",{url:"/thanh-vien/quen-mat-khau.html",templateUrl:"views/public/user/resetpass.html",controller:"UserController",title:"Khôi phục mật khẩu",access:{requiredLogin:!1}}).state("reset-password",{url:"/users/reset-password/:token",templateUrl:"views/public/user/form-reset.html",controller:"resetPasswordController",title:"Khôi phục mật khẩu",access:{requiredLogin:!1}}).state("edit-user",{url:"/chinh-sua-thong-tin/:id/:slug",templateUrl:"views/public/user/edit.html",controller:"EditProfile",title:"Chỉnh sửa thông tin",access:{requiredLogin:!0}}).state("register",{url:"/dang-ky.html",templateUrl:"views/public/register.html",controller:"UserController",title:"Đăng ký thành viên",access:{requiredLogin:!1}}).state("login",{url:"/dang-nhap.html",templateUrl:"views/public/login.html",controller:"UserController",title:"Đăng nhập hệ thống",access:{requiredLogin:!1}}).state("active_account",{url:"/users/active/:user_id/:token",templateUrl:"views/public/notice.html",controller:"UserController",title:"Kích hoạt tài khoản",access:{requiredLogin:!1}}).state("system-user",{url:"/system/users",templateUrl:"views/private/user/manage.html",controller:"ListUserController",title:"Quản lý thành viên",access:{requiredLogin:!0}}).state("system-user-permission",{url:"/system/users/permission/:id",templateUrl:"views/private/user/permission.html",controller:"EditProfile",title:"Quản lý thành viên",access:{requiredLogin:!0}}).state("system",{url:"/system",templateUrl:"views/private/system.html",controller:"MainController",title:"Quản lý Hệ thống",access:{requiredLogin:!0}}).state("tags",{url:"/tags.html",templateUrl:"views/public/tag/index.html",controller:"ListTagController",title:"Tags",access:{requiredLogin:!1}}).state("questions_tag",{url:"/cau-hoi-theo-tag/:id/:slug",templateUrl:"views/public/tag/question.html",controller:"getQuestionByTagController",title:"Tagged Question",access:{requiredLogin:!1}}).state("system-tag",{url:"/system/tags",templateUrl:"views/private/tag/manage.html",controller:"ListTagController",title:"Quản lý Tags",access:{requiredLogin:!0}}).state("system-tag-edit",{url:"/system/tags/edit/:id",templateUrl:"views/private/tag/edit.html",controller:"TagDetail",title:"Quản lý Tags",access:{requiredLogin:!0}}).state("system-setting",{url:"/system/setting",templateUrl:"views/private/setting/index.html",controller:"SystemController",title:"Cấu hình hệ thống",access:{requiredLogin:!0}}).state("system-setting-about",{url:"/system/setting/about",templateUrl:"views/private/setting/about.html",controller:"SystemController",title:"Chỉnh sửa giới thiệu",access:{requiredLogin:!0}}).state("system-setting-policy",{url:"/system/setting/policy",templateUrl:"views/private/setting/policy.html",controller:"SystemController",title:"Chỉnh sửa quy định & điều khoản",access:{requiredLogin:!0}}).state("system-setting-help",{url:"/system/setting/help",templateUrl:"views/private/setting/help.html",controller:"SystemController",title:"Chỉnh sửa hướng dẫn",access:{requiredLogin:!0}}).state("404",{url:"/404.html",templateUrl:"views/public/404.html",title:"404 - Không tìm thấy trang yêu cầu",access:{requiredLogin:!1}}),c.html5Mode(!0),c.hashPrefix("!")}]),angular.module("appDirectives",[]).directive("passwordMatch",[function(){return{restrict:"A",scope:!0,require:"ngModel",link:function(a,b,c,d){var e=function(){var b=a.$eval(c.ngModel),d=a.$eval(c.passwordMatch);return b==d};a.$watch(e,function(a){d.$setValidity("unique",a)})}}}]).directive("enforceMaxTags",function(){return{require:"ngModel",link:function(a,b,c,d){var e=c.maxTags?parseInt(c.maxTags,"10"):null;d.$parsers.push(function(a){return a&&e&&a.length>e&&a.splice(a.length-1,1),a})}}}).directive("wayPoints",function(){return{restrict:"A",link:function(a,b){$(b).length>0&&$(b).waypoint(function(a){"down"==a?$(".fixed-menu").fadeIn():$(".fixed-menu").fadeOut("fast")},{offset:0})}}}).directive("fbLike",["$window","$rootScope",function(a,b){return{restrict:"A",scope:{fbLike:"=?"},link:function(c,d,e){function f(){if(!e.fbLike||c.fbLike||g)d.html('<div class="fb-like"'+(c.fbLike?' data-href="'+c.fbLike+'"':"")+' data-layout="standard" data-action="like" data-show-faces="true" data-share="true"></div>'),a.FB.XFBML.parse(d.parent()[0]);else{g=!0;var b=c.$watch("fbLike",function(a){a&&(f(),b())})}}a.FB?f():$.getScript("//connect.facebook.net/en_US/sdk.js",function(){a.FB.init({appId:b.facebookAppId,xfbml:!0,version:"v2.1"}),f()});var g=!1}}}]),angular.module("appFilters",[]).filter("unsafe",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]).filter("toDate",function(){return function(a){return new Date(a)}}).filter("fromNow",function(){return function(a){return moment(a).fromNow()}}).filter("startFrom",function(){return function(a,b){return a?(b=+b,a.slice(b)):[]}}).filter("getBadge",function(){return function(a,b){for(var c=[],d=0;d<a.length;d++){var e=a[d];if(e.score<=b){c.push(e);break}}return c}}).filter("checkFavorite",function(){return function(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(d.questionId==b)return!0}return!1}}).filter("checkVoteUp",function(){return function(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(d.questionId==b&&d.type===!0)return!0}return!1}}).filter("checkAnswerVoteUp",function(){return function(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(d.answerId==b&&d.type===!0)return!0}return!1}}).filter("countByQuestion",function(){return function(a,b){for(var c=0,d=0;d<a.length;d++){var e=a[d];e.questionId==b&&c++}return c}}).filter("checkVoteDown",function(){return function(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(d.questionId==b&&d.type===!1)return!0}return!1}}).filter("checkAnswerVoteDown",function(){return function(a,b){for(var c=0;c<a.length;c++){var d=a[c];if(d.answerId==b&&d.type===!1)return!0}return!1}}).filter("checkHaveAcepted",function(){return function(a){for(var b=0;b<a.length;b++){var c=a[b];if(c.isAcepted===!0)return!1}return!0}}).filter("friendlyUrl",function(){return function(a){var b=a.replace(/(à|á|ạ|ả|ã|â|ầ|ấ|ậ|ẩ|ẫ|ă|ằ|ắ|ặ|ẳ|ẵ)/g,"a");return b=b.replace(/(è|é|ẹ|ẻ|ẽ|ê|ề|ế|ệ|ể|ễ)/g,"e"),b=b.replace(/(ì|í|ị|ỉ|ĩ)/g,"i"),b=b.replace(/(ò|ó|ọ|ỏ|õ|ô|ồ|ố|ộ|ổ|ỗ|ơ|ờ|ớ|ợ|ở|ỡ)/g,"o"),b=b.replace(/(ù|ú|ụ|ủ|ũ|ư|ừ|ứ|ự|ử|ữ)/g,"u"),b=b.replace(/(ỳ|ý|ỵ|ỷ|ỹ)/g,"y"),b=b.replace(/(đ)/g,"d"),b=b.replace(/(À|Á|Ạ|Ả|Ã|Â|Ầ|Ấ|Ậ|Ẩ|Ẫ|Ă|Ằ|Ắ|Ặ|Ẳ|Ẵ)/g,"A"),b=b.replace(/(È|É|Ẹ|Ẻ|Ẽ|Ê|Ề|Ế|Ệ|Ể|Ễ)/g,"E"),b=b.replace(/(Ì|Í|Ị|Ỉ|Ĩ)/g,"I"),b=b.replace(/(Ò|Ó|Ọ|Ỏ|Õ|Ô|Ồ|Ố|Ộ|Ổ|Ỗ|Ơ|Ờ|Ớ|Ợ|Ở|Ỡ)/g,"O"),b=b.replace(/(Ù|Ú|Ụ|Ủ|Ũ|Ư|Ừ|Ứ|Ự|Ử|Ữ)/g,"U"),b=b.replace(/(Ỳ|Ý|Ỵ|Ỷ|Ỹ)/g,"Y"),b=b.replace(/(Đ)/g,"D"),b=b.replace(/[^A-Za-z0-9 ]/,""),b=b.replace(/\s+/g," "),b=b.trim(),b=b.toLowerCase(),b=b.replace(/\s/g,"-")}}),angular.module("appServices",[]).service("DataAccess",["$http","$q",function(a,b){var c={};this.loadTag=function(b){a.get("/api/tag").success(function(a){c[b]=a.map(function(a){return a.tagName})})},this.searchTag=function(a,d){var e,f=b.defer();return e=_.chain(c[a]).filter(function(a){return a.toLowerCase().indexOf(d.toLowerCase())>-1}).take(10).value(),f.resolve(e),f.promise}}]).service("appAlert",["$modal",function(a){this.alert=function(b){var c=a.open({templateUrl:"/views/modal/alert.html",controller:"modal.alert",backdrop:"static",resolve:{data:function(){return b}}});c.result.then(function(){},function(){})},this.confirm=function(b,c){var d=a.open({templateUrl:"/views/modal/confirm.html",controller:"modal.confirm",backdrop:"static",resolve:{data:function(){return b}}});d.result.then(function(){return c(!0)},function(){return c(!1)})}}]);