/*
Site Name: AZQuestion
Author: Sang Nguyen
Author URI: http://sangnguyen.info
CreationDate:2014-12-21
Version: 1.0
*/
angular.module("AnswerCtrl",[]).controller("AnswerController",["$scope","$rootScope","$cookieStore","$location","$http","flash","$modal","appAlert","Answer",function(a,b,c,d,e,f,g,h,i){a.currentPage=1,a.maxSize=5,a.entryLimit=10,e.get("api/answer/getAll").success(function(b){a.listAnswer=b}).error(function(){console.log("error")}),a.deleteAnswer=function(b,c){h.confirm({title:"Xóa",message:"Bạn chắc chắn muốn xóa câu trả lời này ?"},function(g){g&&i["delete"](b).success(function(){f.success="Xóa thành công!",e.get("api/answer/getAll").success(function(b){a.listAnswer=b,d.path(c)}).error(function(){console.log("error")})})})},a.acepted=function(b){h.confirm({title:"Xác nhận",message:"Bạn có chắc chắn muốn đánh dấu câu trả lời này là đúng?Bạn chỉ được đánh dấu trả lời đúng 1 lần và không thể sửa."},function(c){c&&(e.get("api/answer/acept/"+b).success(function(b){a.listAnswerQuestion=b,e.get("api/question/detail/"+b[0].questionId).success(function(b){b.status||$state.go("404"),a.questionDetail=b})}),f.success="Bạn đã đánh dấu câu trả lời chính xác!")})},a.listAllVote=[],e.get("api/user/vote/all").success(function(b){a.listAllVote=b}).error(function(){console.log("error")}),a.voteUp=function(b,c){e.get("/loggedin").success(function(d){"0"!==d?e.get("api/answer/vote_up/"+b).success(function(b){f.success=1==parseInt(b)?"Bạn đã BỎ thích câu trả lời này!":"Bạn đã thích câu trả lời này!",e.get("api/findAnswers/"+c).success(function(b){a.listAnswerQuestion=b}).error(function(){console.log("error")}),e.get("api/user/vote").success(function(b){a.listVote=b}).error(function(){console.log("error")}),e.get("api/user/vote/all").success(function(b){a.listAllVote=b}).error(function(){console.log("error")})}).error(function(){console.log("error")}):f.error="Bạn cần đăng nhập để bình chọn !"})},a.voteDown=function(b,c){e.get("/loggedin").success(function(d){"0"!==d?e.get("api/answer/vote_down/"+b).success(function(b){f.success=1==parseInt(b)?"Bạn đã BỎ không thích câu trả lời này!":"Bạn Không thích câu trả lời này!",e.get("api/findAnswers/"+c).success(function(b){a.listAnswerQuestion=b}).error(function(){console.log("error")}),e.get("api/user/vote").success(function(b){a.listVote=b}).error(function(){console.log("error")}),e.get("api/user/vote/all").success(function(b){a.listAllVote=b}).error(function(){console.log("error")})}).error(function(){f.error="Có lỗi trong quá trình thực hiện bình chọn. Vui lòng thử lại sau!"}):f.error="Bạn cần đăng nhập để bình chọn !"})}}]).controller("AnswerDetail",["$scope","$http","$stateParams",function(a,b,c){b.get("api/answer/detail/"+c.id).success(function(b){a.answer=b}).error(function(){console.log("error")})}]),angular.module("BadgeCtrl",[]).controller("BadgeController",["$scope","$rootScope","$cookieStore","$state","$http","flash","$modal","appAlert","Badge",function(a,b,c,d,e,f,g,h,i){a.loading=!0,i.get().success(function(b){a.listBadge=b,a.loading=!1}).error(function(){console.log("error")}),a.createBadge=function(){a.Proccess=!0,$.isEmptyObject(a.formData)?(f.error="Bạn cần điền đầy đủ các mục.",a.Proccess=!1):i.create(a.formData).success(function(){a.formData={},a.form.$setPristine(),a.Proccess=!1,f.success="Thêm mới thành công!",d.go("system-badge")}).error(function(){f.error="Danh hiệu này đã được sử dụng.",a.Proccess=!1})},a.deleteBadge=function(b){h.confirm({title:"Xóa",message:"Bạn chắc chắn muốn xóa danh hiệu này ?"},function(c){c&&i["delete"](b).success(function(b){a.listBadge=b,f.success="Xóa thành công!"}).error(function(){f.error="Có lỗi xảy ra. Xóa không thành công!"})})}}]).controller("BadgeDetail",["$scope","$http","$state","$stateParams","flash","Badge",function(a,b,c,d,e,f){b.get("api/badge/detail/"+d.id).success(function(b){a.formData=b}).error(function(){console.log("error")}),a.updateBadge=function(){a.Proccess=!0,$.isEmptyObject(a.formData)?(e.error="Bạn cần điền đầy đủ các mục.",a.Proccess=!1):f.edit(a.formData).success(function(){a.formData={},a.form.$setPristine(),a.Proccess=!1,e.success="Cập nhật thành công!",c.go("system-badge")}).error(function(){e.error="Danh hiệu này đã được sử dụng.",a.Proccess=!1})}}]),angular.module("MainCtrl",[]).controller("MainController",["$scope","$cookieStore","$window","$state","$location","$http","$rootScope","$modal","appAlert","flash","AuthenticationService",function(a,b,c,d,e,f,g,h,i,j,k){a.$on("$viewContentLoaded",function(){$("a.your-remember").click(function(a){a.preventDefault(),$(this).hasClass("clicked")?($(this).removeClass("clicked"),$("input#remember").val(0)):($(this).addClass("clicked"),$("input#remember").val(1))}),moment.locale("vi",{})}),a.fbLike="https://www.facebook.com/toiyeulaptrinhfanpage",a.getClass=function(a){return e.path().substr(0,e.path().length)==a?"/"==a&&"/"==e.path()?"current-menu-item":"/"==a?"":"current-menu-item":""},f.get("/loggedin").success(function(a){"0"!==a&&1==a.status?(b.put("currentUser",a),g.currentUser=b.get("currentUser"),k.isLogged=!0,c.sessionStorage.token=a.token):g.currentUser=null}),a.showForm=function(a){f.get("/loggedin").success(function(b){"0"!==b?$(".show-form."+a).fadeIn(500):j.error="Bạn cần đăng nhập để thực hiện hành động này !"})},a.upload=function(){var a=h.open({templateUrl:"/views/modal/upload.html",controller:"modal.upload",resolve:{}});a.result.then(function(a){console.log(a)},function(a){console.log(a)})}}]),angular.module("appModal",[]).controller("modal.alert",["$scope","$modalInstance","data",function(a,b,c){a.data=c,a.ok=function(){b.close()},a.cancel=function(){b.dismiss()}}]).controller("modal.confirm",["$scope","$modalInstance","data",function(a,b,c){a.data=c,a.ok=function(){b.close()},a.cancel=function(){b.dismiss()}}]).controller("modal.uploadImage",["$scope","$modalInstance","$upload",function(a,b,c){a.uploadper=0,a.showUpload=!0,a.showAlert=!1,a.ok=function(){b.close(a.imgUrl)},a.cancel=function(){b.dismiss("huy bo")},a.onFileSelect=function(b){for(var d=0;d<b.length;d++){var e=b[d];e.size>12e5?a.showAlert=!0:(a.showAlert=!1,a.upload=c.upload({url:"api/user/upload/avatar",method:"POST",withCredentials:!0,file:e}).progress(function(b){a.uploadper=parseInt(100*b.loaded/b.total)}).success(function(b){a.imgUrl=b,a.showUpload=!1}))}}}]).controller("modal.upload",["$scope","$modalInstance","$upload",function(a,b,c){a.uploadper=0,a.showUpload=!0,a.showAlert=!1,a.ok=function(){b.close(a.imgUrl)},a.cancel=function(){b.dismiss("huy bo")},a.onFileSelect=function(b){for(var d=0;d<b.length;d++){var e=b[d];e.size>12e5?a.showAlert=!0:(a.showAlert=!1,a.upload=c.upload({url:"api/user/upload/",method:"POST",withCredentials:!0,file:e}).progress(function(b){a.uploadper=parseInt(100*b.loaded/b.total)}).success(function(b){a.imgUrl=b,a.showUpload=!1}))}}}]),angular.module("QuestionCtrl",[]).controller("QuestionController",["$scope","$cookieStore","$rootScope","$location","$state","$http","$stateParams","flash","$modal","appAlert","Answer","Question",function(a,b,c,d,e,f,g,h,i,j,k,l){a.formData={},a.createQuestion=function(){a.Proccess=!0,$.isEmptyObject(a.formData)?(h.error="Bạn phải điền đầy đủ nội dung",a.Proccess=!1):l.create(a.formData).success(function(b){a.formData={},a.form.$setPristine(),a.Proccess=!1,$(".show-form").fadeOut(),b.status?(h.success="Đăng câu hỏi thành công!",d.path("/cau-hoi/chi-tiet/"+b._id+"/success")):(h.success="Câu hỏi của bạn đã được gửi và đang chờ quản trị viên xét duyệt. Cám ơn bạn đã đăng bài.",e.go("home"))})},a.deleteQuestion=function(b,c){j.confirm({title:"Xóa",message:"Bạn chắc chắn muốn xóa câu hỏi này ?"},function(e){e&&l["delete"](b).success(function(b){h.success="Xóa câu hỏi thành công!",a.listQuestion=b,a.listAdminQuestion=b,d.path(c)})})},a.approve=function(b){j.confirm({title:"Xét duyệt",message:"Bài viết đã duyệt sẽ được hiển thị ngay lập tức lên trang chủ, tiếp tục thao tác?"},function(c){c&&l.approve(b).success(function(b){console.log(b),h.success="Đã duyệt thành công bài viết!",a.listAdminQuestion=b,e.go("system-question")})})},a.closeForm=function(){j.confirm({title:"Xác nhận hủy",message:"Bạn chắc chắn muốn hủy đăng câu hỏi này ?"},function(a){a&&$(".show-form").fadeOut(500)})},a.listAllVote=[],f.get("api/user/vote/all").success(function(b){a.listAllVote=b}).error(function(){console.log("error")}),a.voteUp=function(b){f.get("/loggedin").success(function(c){"0"!==c?f.get("api/question/vote_up/"+b).success(function(c){h.success=1==parseInt(c)?"Bạn đã BỎ thích câu hỏi này!":"Bạn đã thích câu hỏi này!",l.get().success(function(b){a.listQuestion=b,f.get("api/questiontag/getall").success(function(b){a.listTag=b}).error(function(){console.log("error")})}),f.get("api/question/detail/"+b).success(function(b){a.questionDetail=b,a.formAnswer.question_id=b._id}).error(function(){console.log("error")}),f.get("api/user/vote").success(function(b){a.listVote=b}).error(function(){console.log("error")}),f.get("api/user/vote/all").success(function(b){a.listAllVote=b}).error(function(){console.log("error")})}).error(function(){console.log("error")}):h.error="Bạn cần đăng nhập để bình chọn !"})},a.voteDown=function(b){f.get("/loggedin").success(function(c){"0"!==c?f.get("api/question/vote_down/"+b).success(function(c){h.success=1==parseInt(c)?"Bạn đã BỎ không thích câu hỏi này!":"Bạn không thích câu hỏi này!",l.get().success(function(b){a.listQuestion=b,console.log(b),f.get("api/questiontag/getall").success(function(b){a.listTag=b}).error(function(){console.log("error")})}),f.get("api/question/detail/"+b).success(function(b){a.questionDetail=b,a.formAnswer.question_id=b._id}).error(function(){console.log("error")}),f.get("api/user/vote").success(function(b){a.listVote=b}).error(function(){console.log("error")}),f.get("api/user/vote/all").success(function(b){a.listAllVote=b}).error(function(){console.log("error")})}).error(function(){console.log("error")}):h.error="Bạn cần đăng nhập để bình chọn !"})},a.listFavorite=[],a.listVote=[],c.currentUser&&(f.get("api/user/favorite").success(function(b){a.listFavorite=b}).error(function(){console.log("error")}),f.get("api/user/vote").success(function(b){a.listVote=b}).error(function(){console.log("error")})),a.listAllFavorite=[],f.get("api/user/favorite/all").success(function(b){a.listAllFavorite=b}).error(function(){console.log("error")}),a.Favorite=function(b){f.get("/loggedin").success(function(c){"0"!==c?f.get("api/question/favorite/"+b).success(function(b){h.success=1==parseInt(b)?"Bỏ theo dõi thành công!":"Bạn đã theo dõi câu hỏi này!",l.get().success(function(b){a.listQuestion=b,f.get("api/questiontag/getall").success(function(b){a.listTag=b}).error(function(){console.log("error")})}),f.get("api/user/favorite").success(function(b){a.listFavorite=b}).error(function(){console.log("error")}),f.get("api/user/favorite/all").success(function(b){a.listAllFavorite=b}).error(function(){console.log("error")})}).error(function(){console.log("error")}):h.error="Bạn cần đăng nhập để bình chọn !"})},a.listAllAnswer=[],f.get("api/answer").success(function(b){a.listAllAnswer=b}).error(function(){console.log("error")})}]).controller("ListQuestionController",["$scope","$http","flash","$location","Question",function(a,b,c,d,e){a.loading=!0,e.get().success(function(c){a.listQuestion=c,a.loading=!1,b.get("api/questiontag/getall").success(function(b){a.listTag=b}).error(function(){console.log("error")}),b.get("api/question/count").success(function(b){a.totalItems=b}),a.currentPage=1,a.maxSize=5,a.entryLimit=10}).error(function(){console.log("Error")}),b.get("api/question/all").success(function(b){a.listAdminQuestion=b})}]).controller("DetailQuestionController",["$scope","$http","$state","$stateParams","$location","flash","Question","Answer","$modal","appAlert",function(a,b,c,d,e,f,g,h,i,j){a.loading=!0,a.formAnswer={};var k=d.id;b.get("api/question/detail/"+k).success(function(b){b.status||c.go("404"),a.questionDetail=b,a.formAnswer.question_id=b._id,a.questionData=b,a.loading=!1}).error(function(){console.log("error")}),b.get("api/findAnswers/"+k).success(function(b){a.listAnswerQuestion=b}).error(function(){console.log("error")}),b.get("api/answer/count/"+k).success(function(b){a.numberAnswer=b}).error(function(){console.log("error")}),b.get("api/findTags/"+k).success(function(b){a.TagQuestion=b}).error(function(){console.log("error")}),a.createAnswer=function(){a.Proccess=!0,console.log(a.formAnswer),$.isEmptyObject(a.formAnswer)?(f.error="Nội dung trả lời không được để trống.",a.Proccess=!1):h.create(a.formAnswer).success(function(){a.formAnswer.content="",a.Proccess=!1,$(".show-form").fadeOut(),f.success="Gửi trả lời thành công!",b.get("api/findAnswers/"+k).success(function(b){a.listAnswerQuestion=b}).error(function(){console.log("error")}),b.get("api/answer/count/"+k).success(function(b){a.numberAnswer=b}).error(function(){console.log("error")})})},a.deleteAnswer=function(c){j.confirm({title:"Xóa",message:"Bạn chắc chắn muốn xóa câu trả lời này ?"},function(d){d&&h["delete"](c).success(function(){f.success="Xóa thành công!",b.get("api/findAnswers/"+k).success(function(b){a.listAnswerQuestion=b}).error(function(){console.log("error")})})})},b.get("api/findTags/"+k).success(function(b){for(var c=[],d=0;d<b.length;d++){var e=b[d].tagId;c.push(e.tagName)}a.oldTag=c}).error(function(){console.log("error")}),a.editQuestion=function(){a.Proccess=!0,$.isEmptyObject(a.questionData)?(f.error="Bạn phải điền đầy đủ nội dung.",a.Proccess=!1):g.edit(a.questionData).success(function(b){a.Proccess=!1,$(".edit_question_form").fadeOut(),f.success="Sửa câu hỏi thành công!",e.path("/question/detail/"+b._id)})}}]).controller("CountQuestionController",["$scope","$http","Question",function(a,b){b.get("api/question/count").success(function(b){a.countQuestion=b}).error(function(){console.log("error")})}]).controller("PopularQuestionController",["$scope","$http","Question",function(a,b){a.popularQuestion=[],b.get("api/question/popular").success(function(b){a.popularQuestion=b}).error(function(){console.log("error")})}]).controller("QuestionDetail",["$scope","$http","$state","$stateParams","flash","Question",function(a,b,c,d,e,f){var g=d.id;b.get("api/question/detail/"+g).success(function(b){a.formData=b}).error(function(){console.log("error")}),b.get("api/findTags/"+g).success(function(b){for(var c=[],d=0;d<b.length;d++){var e=b[d].tagId;c.push(e.tagName)}a.oldTag=c}).error(function(){console.log("error")}),a.editQuestion=function(){a.Proccess=!0,$.isEmptyObject(a.formData)?(e.error="Bạn phải điền đầy đủ nội dung.",a.Proccess=!1):f.edit(a.formData).success(function(){a.formData={},a.form.$setPristine(),a.Proccess=!1,e.success="Sửa câu hỏi thành công!",c.go("system-question")})}}]),angular.module("SystemCtrl",[]).controller("SystemController",["$scope","$rootScope","$cookieStore","$state","$http","flash","$modal","appAlert","System",function(a,b,c,d,e,f,g,h,i){a.loading=!0,i.get().success(function(b){a.systemData=b,a.loading=!1}),a.editSystemSetting=function(){$.isEmptyObject(a.systemData)?(f.error="Bạn phải điền đầy đủ nội dung.",a.Proccess=!1):i.edit(a.systemData).success(function(){a.Proccess=!1,f.success="Cập nhật thành công!",d.go("system-setting")})}}]),angular.module("TagCtrl",[]).controller("TagController",["$scope","$cookieStore","$http","$location","$rootScope","flash","$modal","appAlert","Tag",function(a,b,c,d,e,f,g,h,i){c.get("api/tag/count").success(function(b){a.totalItems=b,console.log(b)}),a.currentPage=1,a.maxSize=5,a.entryLimit=10,a.formData={},a.createTag=function(){a.Proccess=!0,$.isEmptyObject(a.formData)?(f.error="Bạn cần điền đầy đủ các mục.",a.Proccess=!1):i.create(a.formData).success(function(b){a.formData={},a.form.$setPristine(),a.Proccess=!1,$(".add-tag-box").modal("hide"),f.success="Thêm mới thành công!",a.allTag=b}).error(function(){f.error="Tag này đã được sử dụng.",a.Proccess=!1})},a.deleteTag=function(b){h.confirm({title:"Xóa",message:"Bạn chắc chắn muốn xóa tag này ?"},function(c){c&&i["delete"](b).success(function(b){a.allTag=b,f.success="Xóa thành công!"})})}}]).controller("ListTagController",["$scope","Tag",function(a,b){a.loading=!0,a.allTag=[],b.get().success(function(b){a.allTag=b,a.loading=!1}).error(function(){console.log("Request Failed")})}]).controller("PopularTagController",["$scope","Tag",function(a,b){a.popularTag=[],b.popularTag().success(function(b){a.popularTag=b}).error(function(){console.log("Request Failed")})}]).controller("getQuestionByTagController",["$scope","$stateParams","$http",function(a,b,c){a.currentPage=1,a.maxSize=5,a.entryLimit=10;var d=b.id;c.get("/api/getQuestionByTag/"+d).success(function(b){a.listQuestion=b}).error(function(){console.log("error")}),c.get("/api/tag/getTagById/"+d).success(function(b){a.tag=b[0].tagName}).error(function(){console.log("error")})}]).controller("AutocompleteTagController",["$scope","DataAccess","$http",function(a,b){b.loadTag("tags"),a.loadItems=function(a){return b.searchTag("tags",a)};var c=3;a.$watch("formData.tag.length",function(b){a.placeholder=c>b?"Thêm tối đa "+(c-b)+" tags":"Đã đủ "+c+" tags"})}]).controller("TagDetail",["$scope","$http","$state","$stateParams","flash","Tag",function(a,b,c,d,e,f){b.get("api/tag/detail/"+d.id).success(function(b){a.formData=b,console.log(b)}).error(function(){console.log("error")}),a.updateTag=function(){a.Proccess=!0,$.isEmptyObject(a.formData)?(e.error="Bạn cần điền đầy đủ các mục.",a.Proccess=!1):f.edit(a.formData).success(function(){a.formData={},a.form.$setPristine(),a.Proccess=!1,e.success="Cập nhật thành công!",c.go("system-tag")}).error(function(){e.error="Tag này đã được sử dụng.",a.Proccess=!1})}}]),angular.module("UserCtrl",[]).controller("UserController",["$scope","$state","$rootScope","$cookieStore","$window","$http","$location","$stateParams","flash","$modal","appAlert","User","AuthenticationService",function(a,b,c,d,e,f,g,h,i,j,k,l,m){a.userData={},a.login=function(){a.Proccess=!0,$.isEmptyObject(a.userData)||(c.successMsg="",l.getUserbyEmail(a.userData).success(function(f){console.log(f),f.length>0?0===f[0].status?(i.error="Tài khoản chưa được kích hoạt, vui lòng kiểm tra email và kích hoạt tài khoản!",a.Proccess=!1,b.go("login")):l.login(a.userData).success(function(a){d.put("currentUser",a),c.currentUser=d.get("currentUser"),m.isLogged=!0,e.sessionStorage.token=a.token,i.success="Chào mừng "+d.get("currentUser").displayName+" quay lại!",""!==c.oldState&&"active_account"!==c.oldState?null!==c.oldParam.id?b.go(c.oldState,{id:c.oldParam.id}):b.go(c.oldState):b.go("home")}).error(function(){i.error="Email hoặc mật khẩu không chính xác.",a.Proccess=!1,b.go("login")}):(i.error="Email hoặc mật khẩu không chính xác.",a.Proccess=!1,b.go("login"))}))},a.signup=function(){a.Proccess=!0,$.isEmptyObject(a.userData)||l.signup(a.userData).success(function(){i.success="Đăng ký thành công. Hãy kiểm tra email của bạn để kích hoạt tài khoản!",b.go("home")}).error(function(){i.error="Email này đã được sử dụng, hãy chọn email khác.",a.Proccess=!1,b.go("register")})},a.logout=function(){l.logout().success(function(){c.currentUser=null,d.remove("currentUser"),m.isLogged&&(m.isLogged=!1,delete e.sessionStorage.token),i.success="Đăng xuất thành công!"})},a.deleteUser=function(b,c){k.confirm({title:"Xóa",message:"Bạn chắc chắn muốn xóa thành viên này ?"},function(d){d&&l["delete"](b).success(function(b){null!==b.error_msg?i.error=b.error_msg:(i.success="Xóa thành viên thành công!",a.allUser=b,g.path(c))})})},a.resetPass=function(){a.Proccess=!0,$.isEmptyObject(a.userData)||l.forgot(a.userData).success(function(){i.success="Hệ thống đã gửi thông tin khôi phục tài khoản qua email của bạn, vui lòng kiểm tra email.",a.Proccess=!1,b.go("home")})}}]).controller("ActiveAccount",["$scope","$state","User",function(a,b,c){c.activeAccount().success(function(b){1==b.status?(a.successMsg=!0,a.Message="Kích hoạt tài khoản thành công! Hãy đăng nhập vào hệ thống để sử dụng các chức năng cho thành viên."):(a.successMsg=!1,a.Message="Kích hoạt tài khoản không thành công. Mã token không hợp lệ!")}).error(function(){console.log("error")})}]).controller("ListUserController",["$scope","User","Badge",function(a,b,c){a.loading=!0,a.allUser=[],a.listBadge=[],b.get().success(function(b){a.allUser=b}).error(function(){console.log("error")}),c.get().success(function(b){a.listBadge=b}).error(function(){console.log("error")}),a.loading=!1}]).controller("ProfileUserController",["appAlert","flash","Restangular","$modal","$scope","$rootScope","$http","$state","$stateParams","User","Badge",function(a,b,c,d,e,f,g,h,i,j,k){e.userInfo=[],j.getUserDetail().success(function(a){e.userInfo=a}).error(function(){console.log("error")}),k.get().success(function(a){e.listBadge=a}).error(function(){console.log("error")}),j.countQuestion().success(function(a){e.numberQuestion=a}).error(function(){console.log("error")}),j.countAnswer().success(function(a){e.numberAnswer=a}).error(function(){console.log("error")}),g.get("api/question/getQuestionByUser/"+i.id).success(function(a){e.listQuestion=a}),g.get("api/answer/getAnswerByUser/"+i.id).success(function(a){e.listAnswer=a,console.log(a)}),e.currentPage=1,e.maxSize=5,e.entryLimit=5}]).controller("CountUserController",["$scope","User",function(a,b){b.countUser().success(function(b){a.countUser=b}).error(function(){console.log("Request Failed")})}]).controller("EditProfile",["appAlert","flash","Restangular","$modal","$scope","$rootScope","$http","$state","User",function(a,b,c,d,e,f,g,h,i){i.getUserDetail().success(function(a){e.userAvatar=a.avatar,e.formData=a}).error(function(){console.log("error")}),e.uploadImage=function(){var a=d.open({templateUrl:"/views/modal/upload-image.html",controller:"modal.uploadImage",resolve:{}});a.result.then(function(a){e.newAvatar=a,f.currentUser.avatar="uploads/users/"+a+"?"+16*Math.random()+(new Date).getTime(),g.get("api/user/edit/avatar/"+a).success(function(a){e.userAvatar=a.avatar}).error(function(){console.log("error")}),console.log(a)},function(a){console.log(a)})},e.updateUser=function(){e.Proccess=!0,$.isEmptyObject(e.formData)||i.edit(e.formData).success(function(a){e.formData=a,b.success="Cập nhật thông tin thành công!",e.Proccess=!1}).error(function(){b.error="Có lỗi trong quá trình thay đổi thông tin.",e.Proccess=!1})},e.changePassword=function(){e.Proccess=!0,$.isEmptyObject(e.formData)||i.changePassword(e.formData).success(function(){e.formData={},b.success="Đổi mật khẩu thành công!",e.Proccess=!1}).error(function(){b.error="Mật khẩu hiện tại không chính xác, vui lòng kiểm tra lại!",e.Proccess=!1})},e.updatePermission=function(){e.Proccess=!0,$.isEmptyObject(e.formData)||i.updatePermission(e.formData).success(function(){e.formData={},b.success="Cập nhật quyền hạn cho thành viên thành công!",e.Proccess=!1,h.go("system-user")}).error(function(){b.error="Có lỗi trong quá trình xử lý. Vui lòng thử lại sau!",e.Proccess=!1})}}]).controller("resetPasswordController",["flash","$window","$scope","$rootScope","$http","$state","$stateParams","$cookieStore","User","AuthenticationService",function(a,b,c,d,e,f,g,h,i,j){c.formData={},c.formData.token=g.token,c.resetPassword=function(){c.Proccess=!0,console.log(c.formData),$.isEmptyObject(c.formData)||i.resetPassword(c.formData).success(function(e){console.log(e),c.formData={},c.Proccess=!1,null!==e.error_msg?a.error=e.error_msg:(a.success="Đổi mật khẩu thành công!",h.put("currentUser",e),d.currentUser=h.get("currentUser"),j.isLogged=!0,b.sessionStorage.token=e.token,f.go("home"))}).error(function(){a.error="Có lỗi trong quá trình xử lý yêu cầu. Vui lòng thực hiện lại vào thời điểm khác!",c.Proccess=!1})}}]);